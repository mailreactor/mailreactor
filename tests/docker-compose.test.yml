services:
  greenmail:
    image: greenmail/standalone:2.1.7
    container_name: mailreactor-greenmail
    ports:
      - "3143:3143"  # IMAP (plaintext)
      - "3993:3993"  # IMAPS (SSL)
      - "3025:3025"  # SMTP (plaintext)
      - "3465:3465"  # SMTPS (SSL)
      - "3110:3110"  # POP3 (plaintext)
      - "3995:3995"  # POP3S (SSL)
      - "8080:8080"  # Web API (for test management)
    environment:
      # Auto-create test users on first login
      GREENMAIL_OPTS: >-
        -Dgreenmail.setup.test.all
        -Dgreenmail.hostname=0.0.0.0
        -Dgreenmail.auth.disabled=false
        -Dgreenmail.verbose
        -Dgreenmail.users=test@localhost:test,admin@localhost:admin123
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "3143"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 10s
    networks:
      - mailreactor-test

networks:
  mailreactor-test:
    driver: bridge
