# Pre-commit hooks for Mail Reactor
# See https://pre-commit.com for more information

repos:
  # Ruff - Fast Python linter and formatter
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.6
    hooks:
      - id: ruff
        args: [--fix]
        name: ruff linting
      - id: ruff-format
        name: ruff formatting

  # Mypy - Static type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.18.2
    hooks:
      - id: mypy
        name: mypy type checking
        additional_dependencies: [pydantic>=2.0]
        args: [--ignore-missing-imports]
        exclude: ^tests/  # Skip type checking for tests

  # Detect-secrets - Prevent committing secrets
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: detect secrets
        args: ['--baseline', '.secrets.baseline']
        exclude: package.lock.json

  # Local hooks - Run project-specific tools
  - repo: local
    hooks:
      - id: pytest-check
        name: pytest tests passing
        entry: bash -c 'uv run pytest tests/ --ignore=tests/e2e'
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]
      # Coverage check disabled until Epic 1 has actual code
      # - id: pytest-coverage
      #   name: pytest with 80% coverage
      #   entry: bash -c 'uv run pytest'
      #   args: [--cov=src/mailreactor, --cov-fail-under=80, --cov-report=term-missing:skip-covered]
      #   language: system
      #   pass_filenames: false
      #   always_run: true
      #   stages: [pre-commit]

# Configuration
default_stages: [pre-commit]
fail_fast: false  # Run all hooks even if one fails
